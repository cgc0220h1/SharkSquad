<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout :: head">
    <title>Shark Squad</title>
</head>
<body>

<div class="colorlib-loader"></div>

<div id="page">
    <nav th:replace="layout :: menu"></nav>
    <aside id="colorlib-breadcrumbs">
        <div class="container">
            <div class="row">
                <div class="col-md-12 breadcrumbs text-center">
                    <h2 th:text="*{post.title}"></h2>
                    <p><span><a th:href="@{/}" th:text="#{view.a.home}"></a></span> / <span
                            th:text="*{post.category.title}"></span></p>
                </div>
            </div>
        </div>
    </aside>
    <div id="colorlib-container">
        <div class="container">
            <div class="row">
                <div class="col-md-9 content">
                    <div class="row row-pb-lg">
                        <div class="col-md-12">
                            <div class="blog-entry">
                                <input type="hidden" id="idPost" th:field="*{post.id}">
                                <div class="blog-img blog-detail">
                                    <img th:src="${post.attachments.iterator().hasNext() ? post.attachments.iterator().next().imageLink : '#'}"
                                         class="img-responsive" alt="html5 bootstrap template" src="">
                                </div>
                                <div class="desc">
                                    <p class="meta">
                                        <span class="cat"><a
                                                th:href="@{/categories/__${post.category.anchorName}__/posts}"
                                                th:text="*{post.category.title}"></a></span>
                                        <span class="date" th:text="*{post.createdDate}"></span>
                                        <span class="pos" th:text="#{view.span.by}"></span>
                                        <a style="color: black; font-weight: bold"
                                           th:href="@{/users/__${post.users.username}__}"
                                           th:text="${post.users.username}"></a>
                                    </p>
                                    <h2 th:text="*{post.title}"></h2>
                                    <div th:utext="*{post.content}"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row row-pb-lg">
                        <div class="col-md-12">
                            <!--<h2 class="heading-2">23 Comments</h2>-->
                            <th:block th:each="c : ${allComment}">
                                <div class="review">

                                    <div class="user-img">
                                        <img class="user-img" th:src="${c.users.avatarLink}">
                                    </div>
                                    <div class="desc">
                                        <h4>
                                            <a class="text-left" th:text="*{c.users.username}"
                                               th:href="@{/users/__${c.users.username}__}"></a>
                                            <span class="text-right" th:text="*{c.createdDate}"></span>
                                        </h4>
                                        <p th:text="*{c.content}"></p>
                                        <span class="text-left"><a href="#" class="reply"><i class="icon-reply"></i></a></span>
                                    </div>
                                </div>
                            </th:block>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="heading-2" th:text="#{view.h2.Comment}"></h2>
                            <div>
                                <form id="newComment">
                                    <div class="row form-group">
                                        <div class="col-md-12">
                                            <label for="comment-content"></label>
                                            <textarea name="message" id="comment-content" cols="30" rows="10"
                                                      style="resize: none"
                                                      class="form-control"
                                                      th:placeholder="#{view.text_area.placeholder.write_a_comment}"></textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <input type="submit" th:value="#{view.input.post_comment}"
                                               class="btn btn-primary">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="sidebar">
                        <div class="side">
                            <h2 class="sidebar-heading" th:text="#{view.h2.recent_blog}"></h2>
                            <th:block th:each="post : ${recentPostList}">
                                <div class="f-blog">
                                    <a th:href="@{/posts/__${post.anchorName}__}" class="blog-img">
                                        <img class="img-responsive" alt="html5 bootstrap template"
                                             th:src="${post.attachments.iterator().hasNext() ? post.attachments.iterator().next().imageLink : '#'}">
                                    </a>
                                    <div class="desc">
                                        <h3><a th:href="@{/posts/__${post.anchorName}__}" th:text="*{post.title}"></a>
                                        </h3>
                                        <p class="admin"><span th:text="*{post.createdDate}"></span></p>
                                    </div>
                                </div>
                            </th:block>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="layout :: hotBlog"></div>

    <footer th:replace="layout :: footer"></footer>
</div>

<div th:replace="layout :: backToTop"></div>

<div th:replace="layout :: jquery"></div>

<script>
    $(document).ready(function () {
        $("#newComment").submit(function (event) {
            let content = $("#comment-content").val();
            let today = new Date();
            let json = {
                "content": content,
                "createdDate": today.toLocaleDateString(),
                "updatedDate": today.toLocaleDateString(),
                "users": {
                    "username": "vanduc2514"
                }
            };
            $.ajax({
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                type: "POST",
                data: JSON.stringify(json),
                url: "/api/comments/" + [[${post.anchorName}]],
                error: function () {
                    console.log(this.url);
                },
                success: function (data) {
                    console.log(this.url)
                    console.log(data)
                }
            });
            event.preventDefault();
        })
    })
</script>

</body>
</html>

